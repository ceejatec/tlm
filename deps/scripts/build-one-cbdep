#!/bin/bash -ex

cd deps/packages
rm -rf build
mkdir build
cd build

# Work-around for generating generic "linux" deps
if [ "${DISTRO}" == "linux" ]; then
    cmake .. -DPACKAGE=${PACKAGE} -DCB_DOWNLOAD_DEPS_PLATFORM="linux;all"
elif [ "${DISTRO}" == "all" ]; then
    cmake .. -DPACKAGE=${PACKAGE} -DCB_DOWNLOAD_DEPS_PLATFORM="all" -DCB_DOWNLOAD_DEPS_ARCH="noarch"
else
    cmake .. -DPACKAGE=${PACKAGE}
fi
cmake --build . --target ${PACKAGE}

if [ x$1 = xinstall ]
then
    cd deps/*/*
    tgz=`ls *.tgz`
    md5=`ls *.md5`
    cp $tgz ~/.cbdepscache
    cp $md5 ~/.cbdepscache/$tgz.md5
fi
